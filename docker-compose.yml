version: "3.9" # optional sinece v1.27.0

services:
  
  streamlit:

    environment:
      - STREAMLIT_SERVER_MAX_UPLOAD_SIZE=16
      - STREAMLIT_BROWSER_GATHER_USAGE_STATS=false

    ports:
        - "0.0.0.0:6601:6601"

    build:
      context: Docker
      dockerfile: Dockerfile-streamlit

    working_dir: /streamlit
      
    volumes:
      - ./streamlit:/streamlit
      - ./common/:/streamlit/common
        
    entrypoint: streamlit run streamlit_demo.py --server.port=6601 --server.address=0.0.0.0
    

  gradio:

    # WebRTCの場合は必要
    # network_mode: "host"
    ports:
        - "0.0.0.0:6602:6602"

    build:
      context: Docker
      dockerfile: Dockerfile-gradio

    working_dir: /gradio
      
    volumes:
      - ./gradio:/gradio
      - ./common/:/gradio/common

    environment:
      - GRADIO_SERVER_NAME=0.0.0.0
      - GRADIO_SERVER_PORT=6602
      - GRADIO_NUM_PORTS=1 #自動で試されるポートの数
      - GRADIO_ANALYTICS_ENABLED=True

    
    entrypoint: gradio _00_gradio_demo.py